import{K as W,r as n,m as z,j as e,L as X,S as Z}from"./app-PAcH8mEI.js";import{A as ee,H as se}from"./app-layout-CYRkYMMk.js";import{D as re,f as ae}from"./format-BMAe8L_G.js";import{I as A}from"./input-error-DhixQXJ9.js";import{t as I,m as oe,v as te,D as le,U as ne,T as ie}from"./app-header-layout-0fU0bezq.js";import{B as y,L as de}from"./app-logo-icon-C1GCiWs0.js";import{D,a as ce,b as C,c as S,d as k,e as w,f as L}from"./dialog-Be9wMSGQ.js";import{I as E}from"./input-DocUmPqS.js";import{L as O}from"./label-CY5Yq7-4.js";import{f as _}from"./dateHelper-DeSP8uTY.js";/* empty css            */import"./checkbox-D2uzdcW9.js";import"./index-DQ1IlWpQ.js";import"./index-ClCDInp8.js";function pe({user:r,roleId:a}){const{auth:h}=W().props,g=h.user,[l,f]=n.useState(!1),{post:j,delete:p}=z({roleId:a}),v=()=>{const b=new Promise((i,m)=>{l?j(route("roles.revert",r.id),{preserveScroll:!0,onSuccess:()=>{i()},onError:()=>{m()}}):p(route("roles.revoke",r.id),{preserveScroll:!0,onSuccess:()=>{i()},onError:()=>{m()}})});I.promise(b,{loading:l?"Reverting role...":"Revoking role...",success:l?"Role reverted successfully!":"Role revoked successfully!",error:l?"Failed to revert role!":"Failed to revoke role!",duration:5e3}),f(i=>!i)};return e.jsxs("div",{className:"flex items-center justify-between rounded bg-gray-100 text-sm font-medium",children:[e.jsx("div",{className:"flex items-center gap-1 ps-2",children:e.jsx("span",{children:r.name})}),g.id!==r.id&&e.jsx("div",{children:e.jsx("button",{className:`${l?"text-green-700":"text-red-700"} px-2 py-1 hover:bg-gray-300/60`,onClick:v,children:l?"Revert":"Revoke"})})]},r.id)}const me=[{title:"Roles",href:"/roles"}];function ke({roles:r,tableData:a,allRolesCount:h}){const{canCreate:g,canUpdate:l,canDelete:f}=oe(),[j,p]=n.useState(!1),[v,b]=n.useState([]),[i,m]=n.useState(""),[H,B]=n.useState(null),[q,M]=n.useState(!1),[F,R]=n.useState(null),[K,u]=n.useState(!1),{data:P,setData:T,post:V,delete:Y,processing:x,errors:U,reset:$}=z({name:"",description:""}),G=s=>{const d=new Promise((o,c)=>{Y(route("roles.delete-role",s),{preserveScroll:!0,onSuccess:N=>{const t=N.props.flash;u(!1),R(null),t!=null&&t.error?c(t.error):o()},onError:()=>{u(!1),R(null),c("Failed to delete role.")}})});I.promise(d,{loading:"Deleting role...",success:"Role deleted!",error:o=>o,duration:5e3,description:_(new Date),descriptionClassName:"!text-gray-500",classNames:{success:"!text-green-700",error:"!text-red-700",loading:"!text-blue-700"}})},J=(s,d,o)=>{m(s),B(d),b(o),p(!0)},Q=s=>{s.preventDefault();const d=new Promise((o,c)=>{V(route("roles.add-role"),{preserveScroll:!0,onSuccess:N=>{const t=N.props.flash;$(),M(!1),t!=null&&t.error?c(t.error):o()},onError:()=>{c("Failed to create role.")}})});I.promise(d,{loading:"Creating role...",success:"Role created successfully!",error:o=>o,duration:5e3,description:_(new Date),descriptionClassName:"!text-gray-500",classNames:{success:"!text-green-700",error:"!text-red-700",loading:"!text-blue-700"}})};return e.jsxs(ee,{breadcrumbs:me,children:[e.jsx(X,{title:"Roles"}),e.jsxs("div",{className:"px-4 py-6",children:[e.jsx(se,{title:"Roles",description:"Manage the roles and permissions for your users"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[g("Roles")&&e.jsxs(D,{open:q,onOpenChange:M,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(y,{className:"w-max",children:[e.jsx(te,{}),"Add Role"]})}),e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(k,{children:"Add Role"}),e.jsx(w,{children:"Fill out the form below to create a new role."})]}),e.jsxs("form",{className:"flex flex-col gap-6",onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(O,{htmlFor:"name",children:"Role Name"}),e.jsx(E,{id:"name",type:"text",required:!0,tabIndex:0,autoComplete:"name",value:P.name,onChange:s=>T("name",s.target.value),disabled:x,placeholder:"Full name"})]}),e.jsx(A,{message:U.name,className:"mt-2"})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(O,{htmlFor:"description",children:"Role Description"}),e.jsx(E,{id:"description",type:"text",tabIndex:1,autoComplete:"description",value:P.description,onChange:s=>T("description",s.target.value),disabled:x,placeholder:"Description"})]}),e.jsx(A,{message:U.description,className:"mt-2"})]})]}),e.jsx(L,{children:e.jsxs(y,{type:"submit",className:"mt-2 w-full",tabIndex:5,disabled:x,children:[x&&e.jsx(de,{className:"h-4 w-4 animate-spin"}),"Create Role"]})})]})]})]}),e.jsx(re,{enableSearch:!0,searchDefaultValue:a.search,indexFrom:r.from,enableIndex:!0,headers:[{key:"name",label:"Name"},{key:"description",label:"Description"},{key:"users_count",label:"Users",sortable:!1},{key:"created_at",label:"Date Created"}],data:r.data,customData:[{key:"description",render:s=>s.description?e.jsx("span",{children:s.description}):e.jsx("span",{className:"text-gray-500",children:"No description"})},{key:"created_at",render:s=>s.created_at?e.jsx("span",{children:ae(new Date(s.created_at),"MMMM d, yyyy h:mm a")}):e.jsx("span",{className:"text-gray-500",children:"Not activated"})},{key:"users_count",render:s=>s.users?e.jsx("span",{children:s.users.length}):e.jsx("span",{className:"text-gray-500",children:"No users"})}],actions:[{label:"Manage Role",className:"bg-[#6366f1] hover:bg-[#6366f1]/90",icon:e.jsx(le,{size:14}),showIf:s=>l("Roles"),onClick:s=>Z.visit(route("roles.view",s.id),{preserveScroll:!0})},{label:"",className:"bg-[#3b82f6] hover:bg-[#3b82f6]/90",icon:e.jsx(ne,{size:14}),onClick:s=>J(s.name,s.id,s.users)},{label:"",className:"bg-[#983b3b] hover:bg-[#983b3b]/90",icon:e.jsx(ie,{size:14}),showIf:s=>f("Roles"),onClick:s=>{R(s.id),u(!0)}}],dataCount:h,defaultFilters:a.filters,paginationCurrentPage:a.page,paginationLastPage:r.last_page,baseRoute:"roles",defaultSort:a.sort,defaultSortDirection:a.direction,defaultPerPage:a.perPage,perPagesDropdown:a.perPagesDropdown})]})]}),e.jsx(D,{open:j,onOpenChange:p,modal:!0,children:e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(k,{children:i}),e.jsx(w,{children:"These are the users with this role."})]}),e.jsx("div",{className:"flex flex-col gap-2",children:v.map(s=>e.jsx(pe,{user:s,roleId:H},s.id))})]})}),F&&e.jsx(D,{open:K,onOpenChange:u,children:e.jsx(C,{children:e.jsxs(S,{children:[e.jsx(k,{children:"Are you absolutely sure?"}),e.jsx(w,{children:"This action cannot be undone. This will permanently delete the role and all its associated permissions."}),e.jsx(L,{children:e.jsx(y,{type:"submit",variant:"danger",onClick:()=>G(F),children:"Yes"})})]})})})]})}export{ke as default};
